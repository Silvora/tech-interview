---
title: vue3的diff算法理解?
date: 2024-12-11 13:09:17
categories: 
- Vue
---

# 面试官：你了解vue3的diff算法吗？说说看

在 Vue3 里整个重写了 Diff 算法这一块东西，所以源码的话可以说基本是完全不一样的，但是要做的事还是一样的


## 一、基本原理
- 首先进行新老节点头尾对比，头与头、尾与尾对比，寻找未移动的节点。
- 然后创建一个新节点在旧节点中的位置的映射表，这个映射表的元素如果不为空，代表可复用。
- 然后根据这个映射表计算出最长递增子序列，这个序列中的结点代表可以原地复用。之后移动剩下的新结点到正确的位置即递增序列的间隙中。

> PS： 最后一步如果节点在旧`vnode`中存在，则移动到相应位置 —— 递增序列间隙，如果在旧的 `vnode` 中不存在，那么在递增序列间隙中新增节点。




## 其它
1. vue3的diff算法引入最长递增子序列，尽可能复用了原来的顺序，减少移动次数，提升了性能。发散一下，该算法是移动次数最少的方法吗？

LIS 的优势：
- 复用性强： 通过找到最长公共子序列，可以最大程度地复用已有的 DOM 元素。
- 移动次数少： 减少了 DOM 元素的移动次数，从而降低了 DOM 操作的成本。
- 算法相对简单： 相比于其他一些复杂的 Diff 算法，LIS 算法的实现相对简单。

LIS 算法是否是移动次数最少的方法？

严格来说，LIS 算法并不能保证总是找到移动次数最少的方案。 这是因为：
- 局部最优： LIS 算法关注的是找到最长的公共子序列，而没有考虑其他因素，例如元素之间的相对位置关系。
- 多解性： 对于同一个输入，可能存在多个最长公共子序列，而不同的子序列对应着不同的移动方案。
- 问题复杂性： 找到移动次数最少的方案是一个 NP-hard 问题，对于大规模的数据集，找到全局最优解的计算成本非常高。

因此，LIS 算法是一种启发式算法，它在大多数情况下都能取得较好的效果，但并不能保证总是找到最优解。

